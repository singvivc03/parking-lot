jacoco {
    toolVersion("0.8.5")
    reportsDir(file("$buildDir/customJacocoReportDir"))
}

jacocoTestReport {
    reports {
        xml.enabled(false)
        csv.enabled(false)
        html.destination(file("${buildDir}/jacocoHtml"))
    }
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, excludes: ['com/whatflix/ingestion/config/**',
                                         'com/whatflix/ingestion/migrations/changelog/**'])
        }))
    }
}

jacocoTestCoverageVerification {
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, excludes: ['com/whatflix/ingestion/config/**',
                                         'com/whatflix/ingestion/migrations/changelog/**'])
        }))
    }
    violationRules {
        rule {
            limit {
                minimum = 0.90
            }
        }
    }
}